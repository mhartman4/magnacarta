(function(){"use strict";var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(c,d,e){var f,g;this.appName=c,this.updateActivityTime=b(this.updateActivityTime,this),this.post=b(this.post,this),this.nextPing=a.ping.first,this.lastActiveTime=Date.now(),setInterval(function(a){return function(){return a.save()}}(this),3e5),setTimeout(function(a){return function(){return a.pingDecay()}}(this),this.nextPing),window.addEventListener("click",this.updateActivityTime),this.errors={count:0,total:0,timer:null},window.addEventListener&&a.trackUncaught&&(window.addEventListener("error",this.uncaught),this.errors.timer=setInterval(function(a){return function(){return a.flushUncaught()}}(this),2e3)),this.pid=null,this.userId=d,g=a.getCookie("_sa_tid"),f=g?g.indexOf("~"):-1,-1===f?this.trackId=g:(this.trackId=g.substring(0,f),null==d&&(this.userId=g.substring(f+1))),this.session=a.getCookie("_sa_sid-"+this.appName),(null==this.session||null==this.trackId)&&this["try"](function(a){return a.init(e)})}return a.root="https://api.dev.2nd.io/v1/track/",a.trackUncaught=!0,a.inactivityTimeout=6e5,a.ping={max:25e3,decay:1.5,first:5e3},a.prototype["try"]=function(a){var b;try{a(this)}catch(c){b=c,console.warn&&console.warn(b)}return null},a.prototype.init=function(b){var c,d;return null==b&&(b=null),this.queue=[],c={},this.trackId&&(c.tid=this.trackId),this.userId&&(c.uid=this.userId),d=this.trackId||this.userId?"?"+a.buildQuery(c):"",a.post(a.root+"init"+d,{app:this.appName,params:b},function(a){return function(b,c){var d,e,f,g;if(null!=b)return void(a.queue=null);if(null!=c.sid){if(a.session=c.sid,a.trackId=c.tid,a.save(),null!=a.queue)for(g=a.queue,d=0,e=g.length;e>d;d++)f=g[d],a.post(f[0],f[1],f[2]);return a.queue=null}}}(this)),null},a.prototype.pingDecay=function(){return this.ping(),this.nextPing*=a.ping.decay,this.nextPing>a.ping.max?setInterval(function(a){return function(){return a.ping()}}(this),a.ping.max):setTimeout(function(a){return function(){return a.pingDecay()}}(this),this.nextPing),null},a.prototype.ping=function(){return Date.now()-this.lastActiveTime>a.inactivityTimeout?void 0:(this.post("ping",this.pid,null),null)},a.prototype.count=function(a,b,c,d){var e;return e={type:a,name:b,count:c},null!=d&&(e.params=d),this.post("counter",this.pid,e),null},a.prototype.time=function(a,b,c,d){var e;return e={type:a,name:b,ms:c},null!=d&&(e.params=d),this.post("timing",this.pid,e),null},a.prototype.page=function(a,b,c){var d;return this.pid=(1e3*Date.now()+Math.round(999*Math.random())).toString(),d={name:a,uri:b,params:c},this.post("page",this.pid,d),null},a.prototype.uncaught=function(){return this.errors.count+=1,null},a.prototype.flushUncaught=function(){var b,c;return b=this.errors.count,0===b?null:(this.errors.count=0,this.errors.total+=b,b>200&&(b=200),c=null,this.errors.total>1e3&&(c={cap:1e3},clearInterval(this.errors.timer),window.removeEventListener("error",a.uncaught)),this.count("error","uncaught",b,c))},a.prototype.post=function(b,c,d){var e,f,g,h;return null==this.session?void((null!=(h=this.queue)?h.length:void 0)<20&&this.queue.push([b,c,d])):(e=b.indexOf("?")>=0?"&":"?",f={sid:this.session},c&&(f.pid=c),g=e+a.buildQuery(f),a.post(a.root+b+g,d,null),null)},a.prototype.save=function(){var a,b;if(null!=this.session)return b=Date.now(),a=escape(this.trackId),null!=this.userId&&(a+="~"+escape(this.userId)),document.cookie="_sa_sid-"+this.appName+"="+escape(this.session)+";expires="+new Date(b+18e5).toGMTString(),document.cookie="_sa_tid="+a+";expires="+new Date(b+31556952e3).toGMTString(),null},a.prototype.updateActivityTime=function(){var b;return b=Date.now(),b-this.lastActiveTime>=a.inactivityTimeout&&this.init(),this.lastActiveTime=b,null},a.buildQuery=function(a){var b,c;return function(){var d;d=[];for(b in a)c=a[b],d.push(b+"="+escape(c));return d}().join("&")},a.getCookie=function(a){var b,c,d,e,f;for(f=document.cookie.split("; "),c=0,d=f.length;d>c;c++)if(b=f[c],e=b.split("="),e[0]===a)return unescape(e[1]);return null},a}(),window.Track=a,a.post=function(a,b,c){var d,e;return e=new XMLHttpRequest,e.open("POST",a,!0),null!=c&&(e.onreadystatechange=function(){if(4===e.readyState){if(e.status>300)return c("err");try{c(null,JSON.parse(e.responseText))}catch(a){return c("err")}return null}}),d=null!=b?JSON.stringify(b):null,e.send(d),null}}).call(this);